function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_unsupportedIterableToArray(r)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(r,e){if(r){if("string"==typeof r)return _arrayLikeToArray(r,e);var n=Object.prototype.toString.call(r).slice(8,-1);return"Object"===n&&r.constructor&&(n=r.constructor.name),"Map"===n||"Set"===n?Array.from(r):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(r,e):void 0}}function _iterableToArray(r){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(r))return Array.from(r)}function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}function _arrayLikeToArray(r,e){(null==e||e>r.length)&&(e=r.length);for(var n=0,t=new Array(e);n<e;n++)t[n]=r[n];return t}function _typeof(r){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r})(r)}window.Joomla=window.Joomla||{},function(r,e){"use strict";var n=function r(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t="";return Object.keys(e).forEach((function(o){if("object"!==_typeof(e[o]))return t.length>0&&(t+="&"),void(t+=""===n?"".concat(encodeURIComponent(o),"=").concat(encodeURIComponent(e[o])):"".concat(encodeURIComponent(n),"[").concat(encodeURIComponent(o),"]=").concat(encodeURIComponent(e[o])));t+="".concat(r(e[o],o))})),t},t=function(r,e){var n=r.querySelectorAll(e);return n.length?n[0]:null},o=function(r,e){var n=null;if(!r)return n;var o=r.parentElement;if("FORM"===o.nodeName)return n=t(o,e);var a=o.querySelectorAll("form");if(a.length)for(var i=0;i<a.length;i+=1)if(null!==(n=t(a[i],e)))return n;return null},a=function(e){r.renderMessages({error:[e]})};r.plgSystemWebauthnLogin=function(t,i){var u=e.getElementById(t),l=o(u,"input[name=username]"),c=o(u,"input[name=return]");if(null===l)return r.renderMessages({error:[r.JText._("PLG_SYSTEM_WEBAUTHN_ERR_CANNOT_FIND_USERNAME")]}),!1;var s=l.value,y=c?c.value:null;if(""===s)return r.renderMessages({error:[r.JText._("PLG_SYSTEM_WEBAUTHN_ERR_EMPTY_USERNAME")]}),!1;var f={option:"com_ajax",group:"system",plugin:"webauthn",format:"raw",akaction:"challenge",encoding:"raw",username:s,returnUrl:y};return r.request({url:i,method:"POST",data:n(f),onSuccess:function(e){var n={};try{n=JSON.parse(e)}catch(r){}!function(e,n){var t=function(r){return btoa(String.fromCharCode.apply(String,_toConsumableArray(r)))},o=function(r){var e=r.replace(/-/g,"+").replace(/_/g,"/"),n=e.length%4;if(n){if(1===n)throw new Error("InvalidLengthError: Input base64url string is the wrong length to determine padding");e+=new Array(5-n).join("=")}return e};e.challenge?(e.challenge=Uint8Array.from(window.atob(o(e.challenge)),(function(r){return r.charCodeAt(0)})),e.allowCredentials&&(e.allowCredentials=e.allowCredentials.map((function(r){return r.id=Uint8Array.from(window.atob(o(r.id)),(function(r){return r.charCodeAt(0)})),r}))),navigator.credentials.get({publicKey:e}).then((function(r){var e={id:r.id,type:r.type,rawId:t(new Uint8Array(r.rawId)),response:{authenticatorData:t(new Uint8Array(r.response.authenticatorData)),clientDataJSON:t(new Uint8Array(r.response.clientDataJSON)),signature:t(new Uint8Array(r.response.signature)),userHandle:r.response.userHandle?t(new Uint8Array(r.response.userHandle)):null}};window.location="".concat(n,"&option=com_ajax&group=system&plugin=webauthn&")+"format=raw&akaction=login&encoding=redirect&data=".concat(btoa(JSON.stringify(e)))})).catch((function(r){a(r)}))):a(r.JText._("PLG_SYSTEM_WEBAUTHN_ERR_INVALID_USERNAME"))}(n,i)},onError:function(r){a("".concat(r.status," ").concat(r.statusText))}}),!1};var i=[].slice.call(e.querySelectorAll(".plg_system_webauthn_login_button"));i.length&&i.forEach((function(e){e.addEventListener("click",(function(e){var n=e.currentTarget;r.plgSystemWebauthnLogin(n.getAttribute("data-webauthn-form"),n.getAttribute("data-webauthn-url"))}))}))}(Joomla,document);