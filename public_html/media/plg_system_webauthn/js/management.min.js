function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}window.Joomla=window.Joomla||{},function(e,t){"use strict";var n=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r="";return Object.keys(t).forEach((function(a){if("object"!==_typeof(t[a]))return r.length>0&&(r+="&"),void(r+=""===n?"".concat(encodeURIComponent(a),"=").concat(encodeURIComponent(t[a])):"".concat(encodeURIComponent(n),"[").concat(encodeURIComponent(a),"]=").concat(encodeURIComponent(t[a])));r+="".concat(e(t[a],a))})),r},r=function(t){e.renderMessages({error:[t]})};e.plgSystemWebauthnCreateCredentials=function(a,o){if("credentials"in navigator){var i=t.getElementById(a);if(i){var l=JSON.parse(atob(i.dataset.public_key)),c=atob(i.dataset.postback_url),u=function(e){return btoa(String.fromCharCode.apply(String,_toConsumableArray(e)))},d=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/"),n=t.length%4;if(n){if(1===n)throw new Error("InvalidLengthError: Input base64url string is the wrong length to determine padding");t+=new Array(5-n).join("=")}return t};l.challenge=Uint8Array.from(window.atob(d(l.challenge)),(function(e){return e.charCodeAt(0)})),l.user.id=Uint8Array.from(window.atob(l.user.id),(function(e){return e.charCodeAt(0)})),l.excludeCredentials&&(l.excludeCredentials=l.excludeCredentials.map((function(e){return e.id=Uint8Array.from(window.atob(d(e.id)),(function(e){return e.charCodeAt(0)})),e}))),navigator.credentials.create({publicKey:l}).then((function(a){var i={id:a.id,type:a.type,rawId:u(new Uint8Array(a.rawId)),response:{clientDataJSON:u(new Uint8Array(a.response.clientDataJSON)),attestationObject:u(new Uint8Array(a.response.attestationObject))}},l={option:"com_ajax",group:"system",plugin:"webauthn",format:"raw",akaction:"create",encoding:"raw",data:btoa(JSON.stringify(i))};e.request({url:c,method:"POST",data:n(l),onSuccess:function(n){var r=t.querySelectorAll(o);r&&(r[0].outerHTML=n,e.plgSystemWebauthnInitialize())},onError:function(e){r("".concat(e.status," ").concat(e.statusText))}})})).catch((function(e){r(e)}))}}else e.renderMessages({error:[e.JText._("PLG_SYSTEM_WEBAUTHN_ERR_NO_BROWSER_SUPPORT")]})},e.plgSystemWebauthnEditLabel=function(a,o){var i=t.getElementById(o);if(!i)return!1;var l=atob(i.dataset.postback_url),c=a.parentElement.parentElement,u=c.dataset.credential_id,d=c.querySelectorAll("td"),s=d[0],y=d[1].querySelectorAll("button"),b=y[0],p=y[1],m=s.innerText,_=t.createElement("input");_.type="text",_.name="label",_.defaultValue=m;var f=t.createElement("button");f.className="btn btn-success btn-sm",f.innerText=e.JText._("PLG_SYSTEM_WEBAUTHN_MANAGE_BTN_SAVE_LABEL"),f.addEventListener("click",(function(){var t=_.value;if(""!==t){var a={option:"com_ajax",group:"system",plugin:"webauthn",format:"json",encoding:"json",akaction:"savelabel",credential_id:u,new_label:t};e.request({url:l,method:"POST",data:n(a),onSuccess:function(t){var n=!1;try{n=JSON.parse(t)}catch(e){n="true"===t}!0!==n&&r(e.JText._("PLG_SYSTEM_WEBAUTHN_ERR_LABEL_NOT_SAVED"))},onError:function(t){r("".concat(e.JText._("PLG_SYSTEM_WEBAUTHN_ERR_LABEL_NOT_SAVED")," -- ").concat(t.status," ").concat(t.statusText))}})}return s.innerText=t,b.disabled=!1,p.disabled=!1,!1}),!1);var g=t.createElement("button");return g.className="btn btn-danger btn-sm",g.innerText=e.JText._("PLG_SYSTEM_WEBAUTHN_MANAGE_BTN_CANCEL_LABEL"),g.addEventListener("click",(function(){return s.innerText=m,b.disabled=!1,p.disabled=!1,!1}),!1),s.innerHTML="",s.appendChild(_),s.appendChild(f),s.appendChild(g),b.disabled=!0,p.disabled=!0,!1},e.plgSystemWebauthnDelete=function(a,o){var i=t.getElementById(o);if(!i)return!1;var l=atob(i.dataset.postback_url),c=a.parentElement.parentElement,u=c.dataset.credential_id,d=c.querySelectorAll("td")[1].querySelectorAll("button"),s=d[0],y=d[1];s.disabled=!0,y.disabled=!0;var b={option:"com_ajax",group:"system",plugin:"webauthn",format:"json",encoding:"json",akaction:"delete",credential_id:u};return e.request({url:l,method:"POST",data:n(b),onSuccess:function(t){var n=!1;try{n=JSON.parse(t)}catch(e){n="true"===t}!0===n?c.parentElement.removeChild(c):r(e.JText._("PLG_SYSTEM_WEBAUTHN_ERR_NOT_DELETED"))},onError:function(t){s.disabled=!1,y.disabled=!1,r("".concat(e.JText._("PLG_SYSTEM_WEBAUTHN_ERR_NOT_DELETED")," -- ").concat(t.status," ").concat(t.statusText))}}),!1},e.plgSystemWebauthnAddOnClick=function(t){return t.preventDefault(),e.plgSystemWebauthnCreateCredentials(t.currentTarget.getAttribute("data-random-id"),"#plg_system_webauthn-management-interface"),!1},e.plgSystemWebauthnEditOnClick=function(t){return t.preventDefault(),e.plgSystemWebauthnEditLabel(t.currentTarget,t.currentTarget.getAttribute("data-random-id")),!1},e.plgSystemWebauthnDeleteOnClick=function(t){return t.preventDefault(),e.plgSystemWebauthnDelete(t.currentTarget,t.currentTarget.getAttribute("data-random-id")),!1},e.plgSystemWebauthnInitialize=function(){var n=t.getElementById("plg_system_webauthn-manage-add");n&&n.addEventListener("click",e.plgSystemWebauthnAddOnClick);var r=[].slice.call(t.querySelectorAll(".plg_system_webauthn-manage-edit"));r.length&&r.forEach((function(t){t.addEventListener("click",e.plgSystemWebauthnEditOnClick)}));var a=[].slice.call(t.querySelectorAll(".plg_system_webauthn-manage-delete"));a.length&&a.forEach((function(t){t.addEventListener("click",e.plgSystemWebauthnDeleteOnClick)}))},e.plgSystemWebauthnInitialize()}(Joomla,document);