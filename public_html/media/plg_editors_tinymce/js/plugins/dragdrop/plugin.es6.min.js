tinymce.PluginManager.add("jdragndrop",a=>{function b(b,c){const e=`${a.settings.uploadUri}&path=${a.settings.comMediaAdapter}`,f={[a.settings.csrfToken]:"1",name:b,content:c,parent:a.settings.parentUploadFolder};Joomla.request({url:e,method:"POST",data:JSON.stringify(f),headers:{"Content-Type":"application/json"},onSuccess:b=>{let c;try{c=JSON.parse(b)}catch(b){a.windowManager.alert(`${Joomla.Text._("JERROR")}: {e}`)}if(c.data&&c.data.path){d=c.data;let b;if(/local-/.test(d.adapter)){const{rootFull:a}=Joomla.getOptions("system.paths");b=`${c.data.thumb_path.split(a)[1]}`}else d.thumb_path&&(b=d.thumb_path);const e=c=>{const e=c.getData(),f=e.altEmpty?" alt=\"\"":"",g=e.altText?` alt="${e.altText}"`:f,h=e.isLazy?" loading=\"lazy\"":"",i=e.isLazy?` width="${d.width}"`:"",j=e.isLazy?` height="${d.height}"`:"";a.execCommand("mceInsertContent",!1,`<img src="${b}"${g}${h}${i}${j}/>`)};a.windowManager.open({title:Joomla.Text._("PLG_TINY_DND_ADDITIONALDATA"),body:{type:"panel",items:[{type:"input",name:"altText",label:Joomla.Text._("PLG_TINY_DND_ALTTEXT")},{type:"checkbox",name:"altEmpty",label:Joomla.Text._("PLG_TINY_DND_EMPTY_ALT")},{type:"checkbox",name:"isLazy",label:Joomla.Text._("PLG_TINY_DND_LAZYLOADED")}]},buttons:[{type:"cancel",text:"Cancel"},{type:"submit",name:"submitButton",text:"Save",primary:!0}],initialData:{altText:"",isLazy:!0,altEmpty:!1},onSubmit(a){e(a),a.close()},onCancel(a){e(a)}})}},onError:b=>{a.windowManager.alert(`Error: ${b.statusText}`)}})}function c(a){const c=new FileReader;c.onload=c=>{const{result:d}=c.target,e=d.indexOf("base64")+7,f=d.slice(e,d.length);b(a.name,f)},c.readAsDataURL(a)}let d;tinyMCE.DOM.bind(document,"dragleave",b=>(b.stopPropagation(),b.preventDefault(),a.contentAreaContainer.style.borderWidth="1px 0 0",!1)),a.on("dragenter",a=>(a.stopPropagation(),!1)),a.on("dragover",b=>(b.preventDefault(),a.contentAreaContainer.style.borderStyle="dashed",a.contentAreaContainer.style.borderWidth="5px",!1)),"undefined"==typeof FormData?(Joomla.renderMessages({error:[Joomla.JText._("PLG_TINY_ERR_UNSUPPORTEDBROWSER")]}),a.on("drop",a=>(a.preventDefault(),!1))):a.on("drop",b=>{if(b.preventDefault(),b.dataTransfer&&b.dataTransfer.files&&0<b.dataTransfer.files.length){const a=[].slice.call(b.dataTransfer.files);a.forEach(a=>{a.name.toLowerCase().match(/\.(jpg|jpeg|png|gif)$/)&&c(a)})}a.contentAreaContainer.style.borderWidth="1px 0 0"})});