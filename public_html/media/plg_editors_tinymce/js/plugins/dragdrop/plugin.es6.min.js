tinymce.PluginManager.add("jdragndrop",(t=>{let e;function a(a){const n=new FileReader;n.onload=n=>{const{result:o}=n.target,r=o.indexOf("base64")+7,l=o.slice(r,o.length);!function(a,n){const o=`${t.settings.uploadUri}&path=${t.settings.comMediaAdapter}`,r={[t.settings.csrfToken]:"1",name:a,content:n,parent:t.settings.parentUploadFolder};Joomla.request({url:o,method:"POST",data:JSON.stringify(r),headers:{"Content-Type":"application/json"},onSuccess:a=>{let n;try{n=JSON.parse(a)}catch(e){t.windowManager.alert(`${Joomla.Text._("JERROR")}: {e}`)}if(n.data&&n.data.path){let a;if(e=n.data,/local-/.test(e.adapter)){const{rootFull:t}=Joomla.getOptions("system.paths");a=`${n.data.thumb_path.split(t)[1]}`}else e.thumb_path&&(a=e.thumb_path);const o=n=>{const o=n.getData(),r=o.altEmpty?' alt=""':"",l=o.altText?` alt="${o.altText}"`:r,s=o.isLazy?' loading="lazy"':"",i=o.isLazy?` width="${e.width}"`:"",d=o.isLazy?` height="${e.height}"`:"";t.execCommand("mceInsertContent",!1,`<img src="${a}"${l}${s}${i}${d}/>`)};t.windowManager.open({title:Joomla.Text._("PLG_TINY_DND_ADDITIONALDATA"),body:{type:"panel",items:[{type:"input",name:"altText",label:Joomla.Text._("PLG_TINY_DND_ALTTEXT")},{type:"checkbox",name:"altEmpty",label:Joomla.Text._("PLG_TINY_DND_EMPTY_ALT")},{type:"checkbox",name:"isLazy",label:Joomla.Text._("PLG_TINY_DND_LAZYLOADED")}]},buttons:[{type:"cancel",text:"Cancel"},{type:"submit",name:"submitButton",text:"Save",primary:!0}],initialData:{altText:"",isLazy:!0,altEmpty:!1},onSubmit(t){o(t),t.close()},onCancel(t){o(t)}})}},onError:e=>{t.windowManager.alert(`Error: ${e.statusText}`)}})}(a.name,l)},n.readAsDataURL(a)}tinyMCE.DOM.bind(document,"dragleave",(e=>(e.stopPropagation(),e.preventDefault(),t.contentAreaContainer.style.borderWidth="1px 0 0",!1))),t.on("dragenter",(t=>(t.stopPropagation(),!1))),t.on("dragover",(e=>(e.preventDefault(),t.contentAreaContainer.style.borderStyle="dashed",t.contentAreaContainer.style.borderWidth="5px",!1))),"undefined"!=typeof FormData?t.on("drop",(e=>{if(e.preventDefault(),e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length>0){[].slice.call(e.dataTransfer.files).forEach((t=>{t.name.toLowerCase().match(/\.(jpg|jpeg|png|gif)$/)&&a(t)}))}t.contentAreaContainer.style.borderWidth="1px 0 0"})):(Joomla.renderMessages({error:[Joomla.JText._("PLG_TINY_ERR_UNSUPPORTEDBROWSER")]}),t.on("drop",(t=>(t.preventDefault(),!1))))}));