function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}if(!Joomla)throw new Error("Joomla API is not properly initialised");!function(e,t,n){"use strict";var i,l={view:"dashboard",id:0,ordering:"",version:"current",list:0,options:n.getOptions("plg_installer_webinstaller",{})},r=function(){function i(){_classCallCheck(this,i)}return _createClass(i,[{key:"initialise",value:function(){var e=this;l.loaded=1,t.getElementById("uploadform-web-cancel").addEventListener("click",(function(){t.getElementById("uploadform-web").classList.add("hidden"),l.list&&t.querySelector(".list-view")&&t.querySelector(".list-view").click()})),t.getElementById("uploadform-web-install").addEventListener("click",(function(){4===l.options.installFrom?e.submitButtonUrl():e.submitButtonWeb()})),this.loadweb("".concat(l.options.base_url,"index.php?format=json&option=com_apps&view=dashboard")),this.clickforlinks()}},{key:"loadweb",value:function(r){var a=this;if(!r)return!1;var o=new RegExp(l.options.base_url),s=new RegExp("^index.php");if(!o.test(r)&&!s.test(r))return e.open(r,"_blank"),!1;var c="".concat(r,"&product=").concat(l.options.product,"&release=").concat(l.options.release,"&dev_level=").concat(l.options.dev_level,"&list=").concat(l.list?"list":"grid","&lang=").concat(l.options.language),d=t.getElementById("com-apps-ordering"),u=t.getElementById("com-apps-filter-joomla-version");return""!==l.ordering&&d&&d.value&&(l.ordering=d.value,c+="&ordering=".concat(l.ordering)),""!==l.version&&u&&u.value&&(l.version=u.value,c+="&filter_version=".concat(l.version)),i.showLoadingLayer(),new Promise((function(e,r){n.request({url:c,onSuccess:function(n){var r;try{r=JSON.parse(n)}catch(e){throw new Error("Failed to parse JSON")}t.getElementById("web-loader")&&t.getElementById("web-loader").classList.add("hidden"),t.getElementById("jed-container").innerHTML=r.data.html,t.getElementById("com-apps-searchbox").addEventListener("keypress",(function(e){13===e.which&&a.initiateSearch()})),t.getElementById("search-extensions").addEventListener("click",(function(){a.initiateSearch()})),t.getElementById("search-reset").addEventListener("click",(function(){t.getElementById("com-apps-searchbox").value="",a.initiateSearch()}));var o=t.getElementById("com-apps-ordering"),s=t.getElementById("com-apps-filter-joomla-version");o&&o.addEventListener("change",(function(){var e=o.selectedIndex;l.ordering=o.options[e].value,a.installfromwebajaxsubmit()})),s&&s.addEventListener("change",(function(){var e=s.selectedIndex;l.version=s.options[e].value,a.installfromwebajaxsubmit()})),""!==l.options.installfrom_url&&i.installfromweb(l.options.installfrom_url),e()},onError:function(e){var n=t.getElementById("web-loader-error"),i=t.getElementById("web-loader");e.responseText&&n&&(n.innerHTML=e.responseText),i&&(i.classList.add("hidden"),n.classList.remove("hidden")),r()}})})).finally((function(){var r=t.getElementById("joomlaapsinstallatinput");if(r&&(r.value=l.options.installat_url),a.clickforlinks(),i.clicker(),"extension"!==l.view&&[].slice.call(t.querySelectorAll("div.load-extension")).forEach((function(e){e.addEventListener("click",(function(t){t.preventDefault(),a.processLinkClick(e.getAttribute("data-url"))})),e.setAttribute("href","#")})),"extension"===l.view){var o=t.getElementById("install-extension"),s=t.getElementById("install-extension-from-external");o&&o.addEventListener("click",(function(){i.installfromweb(o.getAttribute("data-downloadurl"),o.getAttribute("data-name")),t.getElementById("uploadform-web-install").scrollIntoView({behavior:"smooth",block:"start"})})),s&&s.addEventListener("click",(function(){var i=s.getAttribute("data-downloadurl");!0===e.confirm(n.Text._("PLG_INSTALLER_WEBINSTALLER_REDIRECT_TO_EXTERNAL_SITE_TO_INSTALL").replace("[SITEURL]",i))&&(t.getElementById("adminForm").setAttribute("action",i),t.querySelector("input[name=task]").setAttribute("disabled",!0),t.querySelector("input[name=install_directory]").setAttribute("disabled",!0),t.querySelector("input[name=install_url]").setAttribute("disabled",!0),t.querySelector("input[name=installtype]").setAttribute("disabled",!0),t.querySelector("input[name=filter_search]").setAttribute("disabled",!0),t.getElementById("adminForm").submit())}))}l.list&&t.querySelector(".list-view")&&t.querySelector(".list-view").click(),i.hideLoadingLayer()})),!0}},{key:"clickforlinks",value:function(){var e=this;[].slice.call(t.querySelectorAll("a.transcode")).forEach((function(t){var n=t.getAttribute("href");t.addEventListener("click",(function(t){t.preventDefault(),e.processLinkClick(n)})),t.setAttribute("href","#")}))}},{key:"initiateSearch",value:function(){l.view="dashboard",this.installfromwebajaxsubmit()}},{key:"installfromwebajaxsubmit",value:function(){var e="&view=".concat(l.view);if(l.id&&(e+="&id=".concat(l.id)),t.getElementById("com-apps-searchbox").value){var n=encodeURI(t.getElementById("com-apps-searchbox").value.toLowerCase().replace(/ +/g,"_").replace(/[^a-z0-9-_]/g,"").trim());e+="&filter_search=".concat(n)}var i=t.getElementById("com-apps-ordering"),r=t.getElementById("com-apps-filter-joomla-version");""!==l.ordering&&i&&i.value&&(l.ordering=i.value),l.ordering&&(e+="&ordering=".concat(l.ordering)),""!==l.version&&r&&r.value&&(l.version=r.value),l.version&&(e+="&filter_version=".concat(l.version)),this.loadweb("".concat(l.options.base_url,"index.php?format=json&option=com_apps").concat(e))}},{key:"processLinkClick",value:function(e){var t=new RegExp(l.options.base_url),n=new RegExp("^index.php");t.test(e)||n.test(e)?(l.view=e.replace(/^.+[&?]view=(\w+).*$/,"$1"),"dashboard"===l.view?l.id=0:"category"===l.view&&(l.id=e.replace(/^.+[&?]id=(\d+).*$/,"$1")),this.loadweb(l.options.base_url+e)):this.loadweb(e)}},{key:"submitButtonUrl",value:function(){var e=t.getElementById("adminForm");if(""===e.install_url.value||"http://"===e.install_url.value||"https://"===e.install_url.value)n.renderMessages({warning:[n.Text._("COM_INSTALLER_MSG_INSTALL_ENTER_A_URL")]});else{var i=t.getElementById("loading");i&&i.classList.remove("hidden"),e.installtype.value="url",e.submit()}}},{key:"submitButtonWeb",value:function(){var e=t.getElementById("adminForm");""!==e.install_url.value||"http://"!==e.install_url.value||"https://"!==e.install_url.value?this.submitButtonUrl():""===e.install_url.value?n.renderMessages({warning:[n.apps.options.btntxt]}):(t.querySelector("#appsloading").classList.remove("hidden"),e.installtype.value="web",e.submit())}}],[{key:"showLoadingLayer",value:function(){t.getElementById("web").appendChild(t.createElement("joomla-core-loader"))}},{key:"hideLoadingLayer",value:function(){var e=t.querySelector("#web joomla-core-loader");e.parentNode.removeChild(e)}},{key:"clicker",value:function(){t.querySelector(".grid-view")&&t.querySelector(".grid-view").addEventListener("click",(function(){l.list=0,t.querySelector(".list-container").classList.add("hidden"),t.querySelector(".grid-container").classList.remove("hidden"),t.getElementById("btn-list-view").classList.remove("active"),t.getElementById("btn-grid-view").classList.remove("active")})),t.querySelector(".list-view")&&t.querySelector(".list-view").addEventListener("click",(function(){l.list=1,t.querySelector(".grid-container").classList.add("hidden"),t.querySelector(".list-container").classList.remove("hidden"),t.getElementById("btn-grid-view").classList.remove("active"),t.getElementById("btn-list-view").classList.add("active")}))}},{key:"installfromweb",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e?(t.getElementById("install_url").value=e,t.getElementById("uploadform-web-url").innerText=e,i?(t.getElementById("uploadform-web-name").innerText=i,t.getElementById("uploadform-web-name-label").classList.remove("hidden")):t.getElementById("uploadform-web-name-label").classList.add("hidden"),t.getElementById("uploadform-web").classList.remove("hidden"),!0):(n.renderMessages({warning:[n.Text._("PLG_INSTALLER_WEBINSTALLER_CANNOT_INSTALL_EXTENSION_IN_PLUGIN")]}),!1)}}]),i}();t.addEventListener("DOMContentLoaded",(function(){e.setTimeout((function n(){var a=t.getElementById("myTab");if("UL"===a.firstElementChild.tagName){var o=a.querySelector("#tab-web");o&&(l.options.installfromon&&o.click(),o.hasAttribute("active")&&!i&&(i=new r).initialise(),""!==l.options.installfrom_url&&o.click(),o.addEventListener("joomla.tab.shown",(function(){i||(i=new r).initialise()})))}else e.setTimeout(n,50)}),50)}))}(window,document,Joomla);