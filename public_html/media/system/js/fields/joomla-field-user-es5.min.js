"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _createSuper(t){var e=_isNativeReflectConstruct();return function(){var n,i=_getPrototypeOf(t);if(e){var o=_getPrototypeOf(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _wrapNativeSuper(t){var e="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(t){if(null===t||!_isNativeFunction(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return _construct(t,arguments,_getPrototypeOf(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(n,t)})(t)}function _construct(t,e,n){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var o=new(Function.bind.apply(t,i));return n&&_setPrototypeOf(o,n.prototype),o}).apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function _isNativeFunction(t){return-1!==Function.toString.call(t).indexOf("[native code]")}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}!function(t,e){var n=function(t){_inherits(i,_wrapNativeSuper(HTMLElement));var n=_createSuper(i);function i(){var t;return _classCallCheck(this,i),(t=n.call(this)).onUserSelect="",t.onchangeStr="",t.buttonClick=t.buttonClick.bind(_assertThisInitialized(t)),t.iframeLoad=t.iframeLoad.bind(_assertThisInitialized(t)),t.modalClose=t.modalClose.bind(_assertThisInitialized(t)),t.setValue=t.setValue.bind(_assertThisInitialized(t)),t}return _createClass(i,[{key:"url",get:function(){return this.getAttribute("url")},set:function(t){this.setAttribute("url",t)}},{key:"modalClass",get:function(){return this.getAttribute("modal")},set:function(t){this.setAttribute("modal",t)}},{key:"modalWidth",get:function(){return this.getAttribute("modal-width")},set:function(t){this.setAttribute("modal-width",t)}},{key:"modalHeight",get:function(){return this.getAttribute("modal-height")},set:function(t){this.setAttribute("modal-height",t)}},{key:"inputId",get:function(){return this.getAttribute("input")},set:function(t){this.setAttribute("input",t)}},{key:"inputNameClass",get:function(){return this.getAttribute("input-name")},set:function(t){this.setAttribute("input-name",t)}},{key:"buttonSelectClass",get:function(){return this.getAttribute("button-select")},set:function(t){this.setAttribute("button-select",t)}},{key:"connectedCallback",value:function(){this.modal=this.querySelector(this.modalClass),this.modalBody=this.querySelector(".modal-body"),this.input=this.querySelector(this.inputId),this.inputName=this.querySelector(this.inputNameClass),this.buttonSelect=this.querySelector(this.buttonSelectClass),this.modal&&window.bootstrap&&window.bootstrap.Modal&&void 0===window.bootstrap.Modal.getInstance(this.modal)&&e.initialiseModal(this.modal,{isJoomla:!0}),this.buttonSelect&&(this.buttonSelect.addEventListener("click",this.modalOpen.bind(this)),this.modal.addEventListener("hide",this.removeIframe.bind(this)),this.onchangeStr=this.input.getAttribute("data-onchange"),this.onchangeStr&&(this.onUserSelect=new Function(this.onchangeStr),this.input.addEventListener("change",this.onUserSelect)))}},{key:"disconnectedCallback",value:function(){this.onchangeStr&&this.input&&this.input.removeEventListener("change",this.onUserSelect),this.buttonSelect&&this.buttonSelect.removeEventListener("click",this),this.modal&&this.modal.removeEventListener("hide",this)}},{key:"buttonClick",value:function(t){var e=t.target;this.setValue(e.getAttribute("data-user-value"),e.getAttribute("data-user-name")),this.modalClose()}},{key:"iframeLoad",value:function(){var t=this,e=this.iframeEl.contentWindow.document;[].slice.call(e.querySelectorAll(".button-select")).forEach((function(e){e.addEventListener("click",t.buttonClick)}))}},{key:"modalOpen",value:function(){this.removeIframe();var t=document.createElement("iframe");t.setAttribute("name","field-user-modal"),t.src=this.url.replace("{field-user-id}",this.input.getAttribute("id")),t.setAttribute("width",this.modalWidth),t.setAttribute("height",this.modalHeight),this.modalBody.appendChild(t),this.modal.open(),this.iframeEl=this.modalBody.querySelector("iframe"),this.iframeEl.addEventListener("load",this.iframeLoad)}},{key:"modalClose",value:function(){e.Modal.getCurrent().close(),this.modalBody.innerHTML=""}},{key:"removeIframe",value:function(){this.modalBody.innerHTML=""}},{key:"setValue",value:function(t,e){this.input.setAttribute("value",t),this.inputName.setAttribute("value",e||t),this.input.dispatchEvent(new Event("change")),this.dispatchEvent(new CustomEvent("change",{detail:{value:t,name:e},bubbles:!0}))}}],[{key:"observedAttributes",get:function(){return["url","modal","modal-width","modal-height","input","input-name","button-select"]}}]),i}();t.define("joomla-field-user",n)}(customElements,Joomla);