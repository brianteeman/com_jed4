"use strict";((a,b)=>{'use strict';if(!b)throw new Error("Joomla API is not properly initiated");b.selectedMediaFile={},window.document.addEventListener("onMediaFileSelected",a=>{b.selectedMediaFile=a.detail;const c=b.Modal.getCurrent(),d=c.querySelector(".modal-body"),e=d.querySelector("joomla-field-mediamore");e&&e.parentNode.removeChild(e);d.closest("joomla-field-media")||b.selectedMediaFile.path&&d.insertAdjacentHTML("afterbegin",`
<joomla-field-mediamore
  parent-id="${c.id}"
  summary-label="${b.Text._("JFIELD_MEDIA_SUMMARY_LABEL")}"
  lazy-label="${b.Text._("JFIELD_MEDIA_LAZY_LABEL")}"
  alt-label="${b.Text._("JFIELD_MEDIA_ALT_LABEL")}"
  alt-check-label="${b.Text._("JFIELD_MEDIA_ALT_CHECK_LABEL")}"
  alt-check-desc-label="${b.Text._("JFIELD_MEDIA_ALT_CHECK_DESC_LABEL")}"
  classes-label="${b.Text._("JFIELD_MEDIA_CLASS_LABEL")}"
  figure-classes-label="${b.Text._("JFIELD_MEDIA_FIGURE_CLASS_LABEL")}"
  figure-caption-label="${b.Text._("JFIELD_MEDIA_FIGURE_CAPTION_LABEL")}"
></joomla-field-mediamore>
`)});const c=a=>"object"==typeof HTMLElement?a instanceof HTMLElement:a&&"object"==typeof a&&1===a.nodeType&&"string"==typeof a.nodeName,d=(a,b,c)=>{const d=encodeURIComponent(b),e=encodeURIComponent(c),f=new RegExp(`(&|\\?)${b}=[^&]*`);let g=a;const h=`${d}=${e}`;return g=g.replace(f,`$1${h}`),!RegExp.$1&&g.includes("?")?`${g}&${h}`:RegExp.$1||g.includes("?")?g:`${g}?${h}`},e=(a,e,f)=>{if(!0===a.success){if(!a.data[0].url)b.selectedMediaFile.url=!1;else if(/local-/.test(a.data[0].adapter)){const{rootFull:c}=b.getOptions("system.paths");b.selectedMediaFile.url=a.data[0].url.split(c)[1],b.selectedMediaFile.thumb=!!a.data[0].thumb_path&&a.data[0].thumb_path}else a.data[0].thumb_path&&(b.selectedMediaFile.thumb=a.data[0].thumb_path);if(b.selectedMediaFile.url){let a,g="",h="",i="",j="",k="",l="",m="";if(!c(e)){const c=f.closest(".modal-content");a=c.querySelector("joomla-field-mediamore"),a&&("true"===a.getAttribute("alt-check")&&(i=" alt=\"\""),h=a.getAttribute("alt-value")?` alt="${a.getAttribute("alt-value")}"`:i,j=a.getAttribute("img-classes")?` class="${a.getAttribute("img-classes")}"`:"",k=a.getAttribute("fig-classes")?` class="${a.getAttribute("fig-classes")}"`:"",l=a.getAttribute("fig-caption")?`${a.getAttribute("fig-caption")}`:"","true"===a.getAttribute("is-lazy")&&(g=` loading="lazy" width="${b.selectedMediaFile.width}" height="${b.selectedMediaFile.height}"`)),m=l?`<figure${k}><img src="${b.selectedMediaFile.url}"${j}${g}${h}/><figcaption>${l}</figcaption></figure>`:`<img src="${b.selectedMediaFile.url}"${j}${g}${h}/>`,a&&a.parentNode.removeChild(a),b.editors.instances[e].replaceSelection(m)}else{const a=d(b.selectedMediaFile.url,"joomla_image_width",b.selectedMediaFile.width);e.value=d(a,"joomla_image_height",b.selectedMediaFile.height),f.updatePreview()}}}};b.getImage=(a,c,d)=>new Promise((f,g)=>{if(!a||"object"==typeof a&&(!a.path||""===a.path))return b.selectedMediaFile={},void f({resp:{success:!1}});const h=`${b.getOptions("system.paths").rootFull}administrator/index.php?option=com_media&format=json`;b.request({url:`${h}&task=api.files&url=true&path=${a.path}&${b.getOptions("csrf.token")}=1&format=json`,method:"GET",perform:!0,headers:{"Content-Type":"application/json"},onSuccess:a=>{const b=JSON.parse(a);f(e(b,c,d))},onError:a=>{g(a)}})});class f extends HTMLElement{constructor(){super(),this.lazyInputFn=this.lazyInputFn.bind(this),this.altInputFn=this.altInputFn.bind(this),this.altCheckFn=this.altCheckFn.bind(this),this.imgClassesFn=this.imgClassesFn.bind(this),this.figclassesFn=this.figclassesFn.bind(this),this.figcaptionFn=this.figcaptionFn.bind(this)}get parentId(){return this.getAttribute("parent-id")}get lazytext(){return this.getAttribute("lazy-label")}get alttext(){return this.getAttribute("alt-label")}get altchecktext(){return this.getAttribute("alt-check-label")}get altcheckdesctext(){return this.getAttribute("alt-check-desc-label")}get classestext(){return this.getAttribute("classes-label")}get figclassestext(){return this.getAttribute("figure-classes-label")}get figcaptiontext(){return this.getAttribute("figure-caption-label")}get summarytext(){return this.getAttribute("summary-label")}connectedCallback(){this.innerHTML=`
<details open>
  <summary>${this.summarytext}</summary>
  <div class="">
    <div class="form-group">
      <div class="input-group">
        <label class="input-group-text" for="${this.parentId}-alt">${this.alttext}</label>
        <input class="form-control" type="text" id="${this.parentId}-alt" />
      </div>
    </div>
    <div class="form-group">
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="${this.parentId}-alt-check">
        <label class="form-check-label" for="${this.parentId}-alt-check">${this.altchecktext}</label>
        <div><small class="form-text text-muted">${this.altcheckdesctext}</small></div>
      </div>
    </div>
    <div class="form-group">
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="${this.parentId}-lazy" checked>
        <label class="form-check-label" for="${this.parentId}-lazy">${this.lazytext}</label>
      </div>
    </div>
    <div class="form-group">
      <div class="input-group">
        <label class="input-group-text" for="${this.parentId}-classes">${this.classestext}</label>
        <input class="form-control" type="text" id="${this.parentId}-classes" />
      </div>
    </div>
    <div class="form-group">
      <div class="input-group">
        <label class="input-group-text" for="${this.parentId}-figclasses">${this.figclassestext}</label>
        <input class="form-control" type="text" id="${this.parentId}-figclasses" />
      </div>
    </div>
    <div class="form-group">
      <div class="input-group">
        <label class="input-group-text" for="${this.parentId}-figcaption">${this.figcaptiontext}</label>
        <input class="form-control" type="text" id="${this.parentId}-figcaption" />
      </div>
    </div>
  </div>
</details>`,this.lazyInput=this.querySelector(`#${this.parentId}-lazy`),this.lazyInput.addEventListener("change",this.lazyInputFn),this.altInput=this.querySelector(`#${this.parentId}-alt`),this.altInput.addEventListener("input",this.altInputFn),this.altCheck=this.querySelector(`#${this.parentId}-alt-check`),this.altCheck.addEventListener("input",this.altCheckFn),this.imgClasses=this.querySelector(`#${this.parentId}-classes`),this.imgClasses.addEventListener("input",this.imgClassesFn),this.figClasses=this.querySelector(`#${this.parentId}-figclasses`),this.figClasses.addEventListener("input",this.figclassesFn),this.figCaption=this.querySelector(`#${this.parentId}-figcaption`),this.figCaption.addEventListener("input",this.figcaptionFn),this.setAttribute("is-lazy",!!this.lazyInput.checked),this.setAttribute("alt-value",""),this.setAttribute("alt-check",!1),this.setAttribute("img-classes",""),this.setAttribute("fig-classes",""),this.setAttribute("fig-caption","")}disconnectedCallback(){this.lazyInput.removeEventListener("input",this.lazyInputFn),this.altInput.removeEventListener("input",this.altInputFn),this.altCheck.removeEventListener("input",this.altCheckFn),this.imgClasses.removeEventListener("input",this.imgClassesFn),this.figClasses.removeEventListener("input",this.figclassesFn),this.figCaption.removeEventListener("input",this.figcaptionFn),this.innerHTML=""}lazyInputFn(a){this.setAttribute("is-lazy",!!a.target.checked)}altInputFn(a){this.setAttribute("alt-value",a.target.value.replace(/"/g,"&quot;"))}altCheckFn(a){this.setAttribute("alt-check",!!a.target.checked)}imgClassesFn(a){this.setAttribute("img-classes",a.target.value)}figclassesFn(a){this.setAttribute("fig-classes",a.target.value)}figcaptionFn(a){this.setAttribute("fig-caption",a.target.value)}}a.define("joomla-field-mediamore",f)})(customElements,Joomla);