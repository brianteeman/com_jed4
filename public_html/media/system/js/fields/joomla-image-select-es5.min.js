"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _createSuper(t){var e=_isNativeReflectConstruct();return function(){var n,i=_getPrototypeOf(t);if(e){var a=_getPrototypeOf(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _wrapNativeSuper(t){var e="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(t){if(null===t||!_isNativeFunction(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return _construct(t,arguments,_getPrototypeOf(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(n,t)})(t)}function _construct(t,e,n){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var a=new(Function.bind.apply(t,i));return n&&_setPrototypeOf(a,n.prototype),a}).apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function _isNativeFunction(t){return-1!==Function.toString.call(t).indexOf("[native code]")}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t,e){if(!e)throw new Error("Joomla API is not properly initiated");e.selectedMediaFile={},window.document.addEventListener("onMediaFileSelected",(function(t){e.selectedMediaFile=t.detail;var n=e.Modal.getCurrent(),i=n.querySelector(".modal-body"),a=i.querySelector("joomla-field-mediamore");a&&a.parentNode.removeChild(a),i.closest("joomla-field-media")||e.selectedMediaFile.path&&i.insertAdjacentHTML("afterbegin",'\n<joomla-field-mediamore\n  parent-id="'.concat(n.id,'"\n  summary-label="').concat(e.Text._("JFIELD_MEDIA_SUMMARY_LABEL"),'"\n  lazy-label="').concat(e.Text._("JFIELD_MEDIA_LAZY_LABEL"),'"\n  alt-label="').concat(e.Text._("JFIELD_MEDIA_ALT_LABEL"),'"\n  alt-check-label="').concat(e.Text._("JFIELD_MEDIA_ALT_CHECK_LABEL"),'"\n  alt-check-desc-label="').concat(e.Text._("JFIELD_MEDIA_ALT_CHECK_DESC_LABEL"),'"\n  classes-label="').concat(e.Text._("JFIELD_MEDIA_CLASS_LABEL"),'"\n  figure-classes-label="').concat(e.Text._("JFIELD_MEDIA_FIGURE_CLASS_LABEL"),'"\n  figure-caption-label="').concat(e.Text._("JFIELD_MEDIA_FIGURE_CAPTION_LABEL"),'"\n></joomla-field-mediamore>\n'))}));var n=function(t,e,n){var i=encodeURIComponent(e),a=encodeURIComponent(n),c=new RegExp("(&|\\?)".concat(e,"=[^&]*")),s=t,o="".concat(i,"=").concat(a);return s=s.replace(c,"$1".concat(o)),!RegExp.$1&&s.includes("?")?"".concat(s,"&").concat(o):RegExp.$1||s.includes("?")?s:"".concat(s,"?").concat(o)},i=function(t,i,a){if(!0===t.success){if(t.data[0].url)if(/local-/.test(t.data[0].adapter)){var c=e.getOptions("system.paths").rootFull;e.selectedMediaFile.url=t.data[0].url.split(c)[1],t.data[0].thumb_path?e.selectedMediaFile.thumb=t.data[0].thumb_path:e.selectedMediaFile.thumb=!1}else t.data[0].thumb_path&&(e.selectedMediaFile.thumb=t.data[0].thumb_path);else e.selectedMediaFile.url=!1;if(e.selectedMediaFile.url){var s,o="",r="",l="",u="",p="",f="",d="";if(g=i,"object"===("undefined"==typeof HTMLElement?"undefined":_typeof(HTMLElement))?g instanceof HTMLElement:g&&"object"===_typeof(g)&&1===g.nodeType&&"string"==typeof g.nodeName){var h=n(e.selectedMediaFile.url,"joomla_image_width",e.selectedMediaFile.width);i.value=n(h,"joomla_image_height",e.selectedMediaFile.height),a.updatePreview()}else{(s=a.closest(".modal-content").querySelector("joomla-field-mediamore"))&&("true"===s.getAttribute("alt-check")&&(l=' alt=""'),r=s.getAttribute("alt-value")?' alt="'.concat(s.getAttribute("alt-value"),'"'):l,u=s.getAttribute("img-classes")?' class="'.concat(s.getAttribute("img-classes"),'"'):"",p=s.getAttribute("fig-classes")?' class="'.concat(s.getAttribute("fig-classes"),'"'):"",f=s.getAttribute("fig-caption")?"".concat(s.getAttribute("fig-caption")):"","true"===s.getAttribute("is-lazy")&&(o=' loading="lazy" width="'.concat(e.selectedMediaFile.width,'" height="').concat(e.selectedMediaFile.height,'"'))),d=f?"<figure".concat(p,'><img src="').concat(e.selectedMediaFile.url,'"').concat(u).concat(o).concat(r,"/><figcaption>").concat(f,"</figcaption></figure>"):'<img src="'.concat(e.selectedMediaFile.url,'"').concat(u).concat(o).concat(r,"/>"),s&&s.parentNode.removeChild(s),e.editors.instances[i].replaceSelection(d)}}}var g};e.getImage=function(t,n,a){return new Promise((function(c,s){if(!t||"object"===_typeof(t)&&(!t.path||""===t.path))return e.selectedMediaFile={},void c({resp:{success:!1}});var o="".concat(e.getOptions("system.paths").rootFull,"administrator/index.php?option=com_media&format=json");e.request({url:"".concat(o,"&task=api.files&url=true&path=").concat(t.path,"&").concat(e.getOptions("csrf.token"),"=1&format=json"),method:"GET",perform:!0,headers:{"Content-Type":"application/json"},onSuccess:function(t){var e=JSON.parse(t);c(i(e,n,a))},onError:function(t){s(t)}})}))};var a=function(t){_inherits(n,_wrapNativeSuper(HTMLElement));var e=_createSuper(n);function n(){var t;return _classCallCheck(this,n),(t=e.call(this)).lazyInputFn=t.lazyInputFn.bind(_assertThisInitialized(t)),t.altInputFn=t.altInputFn.bind(_assertThisInitialized(t)),t.altCheckFn=t.altCheckFn.bind(_assertThisInitialized(t)),t.imgClassesFn=t.imgClassesFn.bind(_assertThisInitialized(t)),t.figclassesFn=t.figclassesFn.bind(_assertThisInitialized(t)),t.figcaptionFn=t.figcaptionFn.bind(_assertThisInitialized(t)),t}return _createClass(n,[{key:"parentId",get:function(){return this.getAttribute("parent-id")}},{key:"lazytext",get:function(){return this.getAttribute("lazy-label")}},{key:"alttext",get:function(){return this.getAttribute("alt-label")}},{key:"altchecktext",get:function(){return this.getAttribute("alt-check-label")}},{key:"altcheckdesctext",get:function(){return this.getAttribute("alt-check-desc-label")}},{key:"classestext",get:function(){return this.getAttribute("classes-label")}},{key:"figclassestext",get:function(){return this.getAttribute("figure-classes-label")}},{key:"figcaptiontext",get:function(){return this.getAttribute("figure-caption-label")}},{key:"summarytext",get:function(){return this.getAttribute("summary-label")}},{key:"connectedCallback",value:function(){this.innerHTML="\n<details open>\n  <summary>".concat(this.summarytext,'</summary>\n  <div class="">\n    <div class="form-group">\n      <div class="input-group">\n        <label class="input-group-text" for="').concat(this.parentId,'-alt">').concat(this.alttext,'</label>\n        <input class="form-control" type="text" id="').concat(this.parentId,'-alt" />\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="form-check">\n        <input class="form-check-input" type="checkbox" id="').concat(this.parentId,'-alt-check">\n        <label class="form-check-label" for="').concat(this.parentId,'-alt-check">').concat(this.altchecktext,'</label>\n        <div><small class="form-text text-muted">').concat(this.altcheckdesctext,'</small></div>\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="form-check">\n        <input class="form-check-input" type="checkbox" id="').concat(this.parentId,'-lazy" checked>\n        <label class="form-check-label" for="').concat(this.parentId,'-lazy">').concat(this.lazytext,'</label>\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="input-group">\n        <label class="input-group-text" for="').concat(this.parentId,'-classes">').concat(this.classestext,'</label>\n        <input class="form-control" type="text" id="').concat(this.parentId,'-classes" />\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="input-group">\n        <label class="input-group-text" for="').concat(this.parentId,'-figclasses">').concat(this.figclassestext,'</label>\n        <input class="form-control" type="text" id="').concat(this.parentId,'-figclasses" />\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="input-group">\n        <label class="input-group-text" for="').concat(this.parentId,'-figcaption">').concat(this.figcaptiontext,'</label>\n        <input class="form-control" type="text" id="').concat(this.parentId,'-figcaption" />\n      </div>\n    </div>\n  </div>\n</details>'),this.lazyInput=this.querySelector("#".concat(this.parentId,"-lazy")),this.lazyInput.addEventListener("change",this.lazyInputFn),this.altInput=this.querySelector("#".concat(this.parentId,"-alt")),this.altInput.addEventListener("input",this.altInputFn),this.altCheck=this.querySelector("#".concat(this.parentId,"-alt-check")),this.altCheck.addEventListener("input",this.altCheckFn),this.imgClasses=this.querySelector("#".concat(this.parentId,"-classes")),this.imgClasses.addEventListener("input",this.imgClassesFn),this.figClasses=this.querySelector("#".concat(this.parentId,"-figclasses")),this.figClasses.addEventListener("input",this.figclassesFn),this.figCaption=this.querySelector("#".concat(this.parentId,"-figcaption")),this.figCaption.addEventListener("input",this.figcaptionFn),this.setAttribute("is-lazy",!!this.lazyInput.checked),this.setAttribute("alt-value",""),this.setAttribute("alt-check",!1),this.setAttribute("img-classes",""),this.setAttribute("fig-classes",""),this.setAttribute("fig-caption","")}},{key:"disconnectedCallback",value:function(){this.lazyInput.removeEventListener("input",this.lazyInputFn),this.altInput.removeEventListener("input",this.altInputFn),this.altCheck.removeEventListener("input",this.altCheckFn),this.imgClasses.removeEventListener("input",this.imgClassesFn),this.figClasses.removeEventListener("input",this.figclassesFn),this.figCaption.removeEventListener("input",this.figcaptionFn),this.innerHTML=""}},{key:"lazyInputFn",value:function(t){this.setAttribute("is-lazy",!!t.target.checked)}},{key:"altInputFn",value:function(t){this.setAttribute("alt-value",t.target.value.replace(/"/g,"&quot;"))}},{key:"altCheckFn",value:function(t){this.setAttribute("alt-check",!!t.target.checked)}},{key:"imgClassesFn",value:function(t){this.setAttribute("img-classes",t.target.value)}},{key:"figclassesFn",value:function(t){this.setAttribute("fig-classes",t.target.value)}},{key:"figcaptionFn",value:function(t){this.setAttribute("fig-caption",t.target.value)}}]),n}();t.define("joomla-field-mediamore",a)}(customElements,Joomla);