import{_ as _objectSpread2}from"./carousel.js";import{B as BaseComponent,E as EventHandler,S as SelectorEngine,f as getSelectorFromElement,M as Manipulator,h as isElement,k as getUID,b as typeCheckConfig,D as Data,d as defineJQueryPlugin}from"./dom.min.js?1614308452";var NAME="scrollspy",DATA_KEY="bs.scrollspy",EVENT_KEY=".".concat(DATA_KEY),DATA_API_KEY=".data-api",Default={offset:10,method:"auto",target:""},DefaultType={offset:"number",method:"string",target:"(string|element)"},EVENT_ACTIVATE="activate".concat(EVENT_KEY),EVENT_SCROLL="scroll".concat(EVENT_KEY),EVENT_LOAD_DATA_API="load".concat(EVENT_KEY).concat(DATA_API_KEY),CLASS_NAME_DROPDOWN_ITEM="dropdown-item",CLASS_NAME_ACTIVE="active",SELECTOR_DATA_SPY='[data-bs-spy="scroll"]',SELECTOR_NAV_LIST_GROUP=".nav, .list-group",SELECTOR_NAV_LINKS=".nav-link",SELECTOR_NAV_ITEMS=".nav-item",SELECTOR_LIST_ITEMS=".list-group-item",SELECTOR_DROPDOWN=".dropdown",SELECTOR_DROPDOWN_TOGGLE=".dropdown-toggle",METHOD_OFFSET="offset",METHOD_POSITION="position";class ScrollSpy extends BaseComponent{constructor(t,e){super(t),this._scrollElement="BODY"===t.tagName?window:t,this._config=this._getConfig(e),this._selector="".concat(this._config.target," ").concat(SELECTOR_NAV_LINKS,", ").concat(this._config.target," ").concat(SELECTOR_LIST_ITEMS,", ").concat(this._config.target," .").concat(CLASS_NAME_DROPDOWN_ITEM),this._offsets=[],this._targets=[],this._activeTarget=null,this._scrollHeight=0,EventHandler.on(this._scrollElement,EVENT_SCROLL,(()=>this._process())),this.refresh(),this._process()}static get Default(){return Default}static get DATA_KEY(){return DATA_KEY}refresh(){var t=this._scrollElement===this._scrollElement.window?METHOD_OFFSET:METHOD_POSITION,e="auto"===this._config.method?t:this._config.method,s=e===METHOD_POSITION?this._getScrollTop():0;this._offsets=[],this._targets=[],this._scrollHeight=this._getScrollHeight(),SelectorEngine.find(this._selector).map((t=>{var o=getSelectorFromElement(t),r=o?SelectorEngine.findOne(o):null;if(r){var i=r.getBoundingClientRect();if(i.width||i.height)return[Manipulator[e](r).top+s,o]}return null})).filter((t=>t)).sort(((t,e)=>t[0]-e[0])).forEach((t=>{this._offsets.push(t[0]),this._targets.push(t[1])}))}dispose(){super.dispose(),EventHandler.off(this._scrollElement,EVENT_KEY),this._scrollElement=null,this._config=null,this._selector=null,this._offsets=null,this._targets=null,this._activeTarget=null,this._scrollHeight=null}_getConfig(t){if("string"!=typeof(t=_objectSpread2(_objectSpread2({},Default),"object"==typeof t&&t?t:{})).target&&isElement(t.target)){var{id:e}=t.target;e||(e=getUID(NAME),t.target.id=e),t.target="#".concat(e)}return typeCheckConfig(NAME,t,DefaultType),t}_getScrollTop(){return this._scrollElement===window?this._scrollElement.pageYOffset:this._scrollElement.scrollTop}_getScrollHeight(){return this._scrollElement.scrollHeight||Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}_getOffsetHeight(){return this._scrollElement===window?window.innerHeight:this._scrollElement.getBoundingClientRect().height}_process(){var t=this._getScrollTop()+this._config.offset,e=this._getScrollHeight(),s=this._config.offset+e-this._getOffsetHeight();if(this._scrollHeight!==e&&this.refresh(),t>=s){var o=this._targets[this._targets.length-1];this._activeTarget!==o&&this._activate(o)}else{if(this._activeTarget&&t<this._offsets[0]&&this._offsets[0]>0)return this._activeTarget=null,void this._clear();for(var r=this._offsets.length;r--;){this._activeTarget!==this._targets[r]&&t>=this._offsets[r]&&(void 0===this._offsets[r+1]||t<this._offsets[r+1])&&this._activate(this._targets[r])}}}_activate(t){this._activeTarget=t,this._clear();var e=this._selector.split(",").map((e=>"".concat(e,'[data-bs-target="').concat(t,'"],').concat(e,'[href="').concat(t,'"]'))),s=SelectorEngine.findOne(e.join(","));s.classList.contains(CLASS_NAME_DROPDOWN_ITEM)?(SelectorEngine.findOne(SELECTOR_DROPDOWN_TOGGLE,s.closest(SELECTOR_DROPDOWN)).classList.add(CLASS_NAME_ACTIVE),s.classList.add(CLASS_NAME_ACTIVE)):(s.classList.add(CLASS_NAME_ACTIVE),SelectorEngine.parents(s,SELECTOR_NAV_LIST_GROUP).forEach((t=>{SelectorEngine.prev(t,"".concat(SELECTOR_NAV_LINKS,", ").concat(SELECTOR_LIST_ITEMS)).forEach((t=>t.classList.add(CLASS_NAME_ACTIVE))),SelectorEngine.prev(t,SELECTOR_NAV_ITEMS).forEach((t=>{SelectorEngine.children(t,SELECTOR_NAV_LINKS).forEach((t=>t.classList.add(CLASS_NAME_ACTIVE)))}))}))),EventHandler.trigger(this._scrollElement,EVENT_ACTIVATE,{relatedTarget:t})}_clear(){SelectorEngine.find(this._selector).filter((t=>t.classList.contains(CLASS_NAME_ACTIVE))).forEach((t=>t.classList.remove(CLASS_NAME_ACTIVE)))}static jQueryInterface(t){return this.each((function(){var e=Data.getData(this,DATA_KEY);if(e||(e=new ScrollSpy(this,"object"==typeof t&&t)),"string"==typeof t){if(void 0===e[t])throw new TypeError('No method named "'.concat(t,'"'));e[t]()}}))}}if(EventHandler.on(window,EVENT_LOAD_DATA_API,(()=>{SelectorEngine.find(SELECTOR_DATA_SPY).forEach((t=>new ScrollSpy(t,Manipulator.getDataAttributes(t))))})),defineJQueryPlugin(NAME,ScrollSpy),window.bootstrap=window.bootstrap||{},window.bootstrap.Scrollspy=ScrollSpy,Joomla&&Joomla.getOptions){var scrollspys=Joomla.getOptions("bootstrap.scrollspy");"object"==typeof scrollspys&&null!==scrollspys&&Object.keys(scrollspys).forEach((t=>{var e=scrollspys[t],s={offset:e.offset?e.offset:10,method:e.method?e.method:"auto"};e.target&&(s.target=e.target);var o=Array.from(document.querySelectorAll(t));o.length&&o.map((t=>new window.bootstrap.Scrollspy(t,s)))}))}export{ScrollSpy as S};